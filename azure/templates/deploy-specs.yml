steps:
- bash: |
   echo "Deploying specs to $(APIGEE_ENVIRONMENT)"
  displayName: 'Deploy Specs to $(APIGEE_ENVIRONMENT) > Deploy Summary'

- bash: 'sudo apt-get install npm curl jq -y'
  displayName: 'Deploy Specs to $(APIGEE_ENVIRONMENT) > Setup curl and jq'

- task: UsePythonVersion@0
  displayName: 'Deploy Specs to $(APIGEE_ENVIRONMENT) > Use Python 3.8'
  inputs:
    versionSpec: 3.8

- template: ../components/setup-utils.yml
  parameters:
    serviceName: $(SERVICE_NAME)

- template: ../components/get-mfa-code.yml
  parameters:
    serviceName: $(SERVICE_NAME)
    apigeeOTPKey: $(APIGEE_OTP_KEY)

- template: ../components/get-access-token.yml
  parameters:
    serviceName: $(SERVICE_NAME)

- bash: |
   cd utils
   poetry run python spec_uploader.py $(APIGEE_ORGANIZATION) --spec-file="$(Pipeline.Workspace)/$(SERVICE_NAME)/*/$(SPEC_FILE_NAME).json" --access-token="$(secret.AccessToken)" --friendly-name="$(FRIENDLY_NAME)"
  displayName: 'Deploy Specs to $(APIGEE_ENVIRONMENT) > Deploy specs & portal'
